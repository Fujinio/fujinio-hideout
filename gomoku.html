<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬æ ¼äº”ç›®ä¸¦ã¹ - è—¤é³°ã®éš ã‚Œå®¶</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .grid-cols-15 { grid-template-columns: repeat(15, minmax(0, 1fr)); }
        .stone-black { background: radial-gradient(circle at 30% 30%, #444, #000); box-shadow: 2px 2px 4px rgba(0,0,0,0.4); }
        .stone-white { background: radial-gradient(circle at 30% 30%, #fff, #ccc); box-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .board-line-h { position: absolute; top: 50%; left: 0; right: 0; height: 1px; background-color: rgba(0,0,0,0.3); z-index: 0; }
        .board-line-v { position: absolute; left: 50%; top: 0; bottom: 0; width: 1px; background-color: rgba(0,0,0,0.3); z-index: 0; }
    </style>
</head>
<body class="bg-orange-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
        const RotateCcw = () => <span>ğŸ”„</span>;
        const Cpu = () => <span>ğŸ’»</span>;
        const User = () => <span>ğŸ‘¤</span>;
        const Shuffle = () => <span>ğŸ”€</span>;

        // --- ã“ã“ã‹ã‚‰è—¤é³°ã•ã‚“ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Œå…¨ç§»æ¤ ---
        const BOARD_SIZE = 15;
        const OPENINGS = {
            '0,1': { name: 'ç›´ç ', description: 'æœ€ã‚‚åŸºæœ¬çš„ãªå¸ƒçŸ³ã€‚' },
            '1,0': { name: 'èŠ±æœˆ', description: 'æ”»æ’ƒçš„ãªå¸ƒçŸ³ã€‚é»’ãŒæœ‰åˆ©ã¨ã•ã‚Œã‚‹ã€‚' },
            '1,1': { name: 'æ–œæœˆ', description: 'å¤‰åŒ–ã«å¯Œã‚“ã å±•é–‹ã«ã€‚' },
            '1,-1': { name: 'æ®‹æœˆ', description: 'å®ˆå‚™çš„ãªå¸ƒçŸ³ã€‚' },
            // ... (å†…éƒ¨ãƒ­ã‚¸ãƒƒã‚¯ç”¨ã«ä¿æŒ)
        };

        function GomokuGame() {
            // ã‚¹ãƒ†ãƒ¼ãƒˆï¼ˆè—¤é³°ã•ã‚“ã®ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ï¼ï¼‰
            const [board, setBoard] = useState(Array(BOARD_SIZE).fill(null).map(() => Array(BOARD_SIZE).fill(null)));
            const [currentPlayer, setCurrentPlayer] = useState('black');
            const [winner, setWinner] = useState(null);
            const [winningLine, setWinningLine] = useState([]);
            const [gameMode, setGameMode] = useState(null);
            const [ruleMode, setRuleMode] = useState(null);
            const [playerColor, setPlayerColor] = useState(null);
            const [difficulty, setDifficulty] = useState(null);
            const [isAIThinking, setIsAIThinking] = useState(false);
            const [moveHistory, setMoveHistory] = useState([]);

            // --- åˆ¤å®šãƒ»AIãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã“ã“ãŒè—¤é³°ã•ã‚“ã®ã“ã ã‚ã‚Šï¼ï¼‰ ---

            const countInDirection = (b, row, col, dx, dy, player) => {
                let count = 0;
                for (let i = 1; i < BOARD_SIZE; i++) {
                    const r = row + dx * i, c = col + dy * i;
                    if (r < 0 || r >= BOARD_SIZE || c < 0 || c >= BOARD_SIZE || b[r][c] !== player) break;
                    count++;
                }
                return count;
            };

            const isWinningMove = (b, row, col, player) => {
                const directions = [[1, 0], [0, 1], [1, 1], [1, -1]];
                for (let [dx, dy] of directions) {
                    const c1 = countInDirection(b, row, col, dx, dy, player);
                    const c2 = countInDirection(b, row, col, -dx, -dy, player);
                    if (c1 + c2 + 1 >= 5) return true;
                }
                return false;
            };

            // AIã®ã‚¹ã‚³ã‚¢è©•ä¾¡ï¼ˆè—¤é³°ã•ã‚“ã® evaluatePosition ãã®ã¾ã¾ï¼‰
            const evaluatePosition = (b, row, col, player) => {
                const directions = [[0, 1], [1, 0], [1, 1], [1, -1]];
                let score = 0;
                const opponent = player === 'black' ? 'white' : 'black';
                
                for (let [dx, dy] of directions) {
                    const myCount = countInDirection(b, row, col, dx, dy, player) + countInDirection(b, row, col, -dx, -dy, player) + 1;
                    const oppCount = countInDirection(b, row, col, dx, dy, opponent) + countInDirection(b, row, col, -dx, -dy, opponent) + 1;
                    
                    if (myCount >= 5) score += 100000;
                    if (oppCount >= 5) score += 50000; // é˜²å¾¡
                    score += myCount * 10;
                }
                return score;
            };

            const makeMove = (row, col, player) => {
                const newBoard = board.map(r => [...r]);
                newBoard[row][col] = player;
                setBoard(newBoard);
                setMoveHistory(prev => [...prev, [row, col]]);

                const winLine = isWinningMove(newBoard, row, col, player);
                if (winLine) {
                    setWinner(player);
                    return true;
                }
                return false;
            };

            const handleCellClick = (r, c) => {
                if (board[r][c] || winner || isAIThinking) return;
                if (gameMode === 'ai' && currentPlayer !== playerColor) return;

                const hasWon = makeMove(r, c, currentPlayer);
                if (!hasWon) setCurrentPlayer(currentPlayer === 'black' ? 'white' : 'black');
            };

            // AIæ€è€ƒï¼ˆè—¤é³°ã•ã‚“ã® getAIMove ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
            useEffect(() => {
                const aiColor = playerColor === 'black' ? 'white' : 'black';
                if (gameMode === 'ai' && currentPlayer === aiColor && !winner) {
                    setIsAIThinking(true);
                    setTimeout(() => {
                        let bestScore = -1;
                        let bestMove = null;
                        
                        // å…¨ã¦ã®ç©ºããƒã‚¹ã‚’è©•ä¾¡
                        for (let r = 0; r < BOARD_SIZE; r++) {
                            for (let c = 0; c < BOARD_SIZE; c++) {
                                if (!board[r][c]) {
                                    const score = evaluatePosition(board, r, c, aiColor);
                                    if (score > bestScore) {
                                        bestScore = score;
                                        bestMove = [r, c];
                                    }
                                }
                            }
                        }

                        if (bestMove) {
                            const hasWon = makeMove(bestMove[0], bestMove[1], aiColor);
                            if (!hasWon) setCurrentPlayer(playerColor);
                        }
                        setIsAIThinking(false);
                    }, 600);
                }
            }, [currentPlayer, winner]);

            // --- ç”»é¢è¡¨ç¤ºéƒ¨åˆ†ï¼ˆTailwindã§ç¶ºéº—ã«ï¼ï¼‰ ---

            if (!gameMode) {
                return (
                    <div className="flex items-center justify-center min-h-screen p-4">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center">
                            <h1 className="text-4xl font-bold mb-8 text-gray-800">æœ¬æ ¼ äº”ç›®ä¸¦ã¹</h1>
                            <div className="space-y-4">
                                <button onClick={() => setGameMode('ai')} className="w-full bg-purple-600 text-white py-6 rounded-2xl font-bold text-xl hover:bg-purple-700 transition flex items-center justify-center gap-3 shadow-lg">
                                    <Cpu /> AIå¯¾æˆ¦ã‚’å§‹ã‚ã‚‹
                                </button>
                                <button onClick={() => {setGameMode('pvp'); setPlayerColor('black');}} className="w-full bg-blue-600 text-white py-6 rounded-2xl font-bold text-xl hover:bg-blue-700 transition flex items-center justify-center gap-3 shadow-lg">
                                    <User /> å‹é”ã¨å¯¾æˆ¦ã™ã‚‹
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (gameMode === 'ai' && !difficulty) {
                return (
                    <div className="flex items-center justify-center min-h-screen p-4">
                        <div className="bg-white rounded-3xl shadow-2xl p-8 max-w-md w-full text-center">
                            <h2 className="text-2xl font-bold mb-6">å…ˆæ‰‹ãƒ»å¾Œæ‰‹ã‚’é¸æŠ</h2>
                            <div className="grid grid-cols-2 gap-4">
                                <button onClick={() => {setPlayerColor('black'); setDifficulty(3);}} className="bg-gray-800 text-white py-4 rounded-xl font-bold">é»’ (å…ˆæ‰‹)</button>
                                <button onClick={() => {setPlayerColor('white'); setDifficulty(3);}} className="bg-gray-100 border-2 border-gray-300 py-4 rounded-xl font-bold">ç™½ (å¾Œæ‰‹)</button>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col items-center justify-center min-h-screen p-2">
                    <div className="bg-amber-100 p-4 rounded-2xl shadow-2xl border-4 border-amber-900">
                        <div className="mb-4 text-center">
                            <div className={`text-xl font-bold ${winner ? 'text-red-600 animate-bounce' : 'text-amber-900'}`}>
                                {winner ? `${winner === 'black' ? 'é»’' : 'ç™½'}ã®å‹åˆ©ï¼` : `æ‰‹ç•ªï¼š${currentPlayer === 'black' ? 'é»’' : 'ç™½'}`}
                            </div>
                        </div>

                        <div className="grid grid-cols-15 bg-amber-600 border border-amber-900 relative">
                            {board.map((row, r) => row.map((cell, c) => (
                                <div 
                                    key={`${r}-${c}`}
                                    onClick={() => handleCellClick(r, c)}
                                    className="w-6 h-6 sm:w-8 sm:h-8 md:w-10 md:h-10 border border-amber-800/20 flex items-center justify-center relative cursor-pointer"
                                >
                                    <div className="board-line-h"></div>
                                    <div className="board-line-v"></div>
                                    {cell && (
                                        <div className={`w-[85%] h-[85%] rounded-full z-10 ${cell === 'black' ? 'stone-black' : 'stone-white'}`} />
                                    )}
                                </div>
                            )))}
                        </div>

                        <button onClick={() => location.reload()} className="mt-6 w-full bg-amber-900 text-white py-3 rounded-xl font-bold hover:bg-black transition">
                            ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹
                        </button>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<GomokuGame />);
    </script>
</body>
</html>
